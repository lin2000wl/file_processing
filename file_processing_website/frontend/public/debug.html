<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API调试页面</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-item { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { margin: 5px; padding: 8px 16px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>API连接调试</h1>
    
    <button onclick="testDirectBackend()">测试直接后端连接</button>
    <button onclick="testProxyAPI()">测试代理API</button>
    <button onclick="testTasksAPI()">测试任务API</button>
    <button onclick="clearResults()">清空结果</button>
    
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(title, success, data) {
            const div = document.createElement('div');
            div.className = `test-item ${success ? 'success' : 'error'}`;
            div.innerHTML = `
                <h3>${success ? '✅' : '❌'} ${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        async function testDirectBackend() {
            try {
                const response = await fetch('http://localhost:8000/health', {
                    mode: 'cors'
                });
                const data = await response.json();
                addResult('直接后端连接', true, data);
            } catch (error) {
                addResult('直接后端连接', false, { error: error.message });
            }
        }
        
        async function testProxyAPI() {
            try {
                const response = await fetch('/api/v1/tasks/');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                addResult('代理API连接', true, data);
            } catch (error) {
                addResult('代理API连接', false, { error: error.message });
            }
        }
        
        async function testTasksAPI() {
            try {
                // 测试不同的API端点
                const endpoints = [
                    '/api/v1/tasks/',
                    'http://localhost:8000/api/v1/tasks/'
                ];
                
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint);
                        const data = await response.json();
                        addResult(`任务API (${endpoint})`, true, data);
                    } catch (error) {
                        addResult(`任务API (${endpoint})`, false, { error: error.message });
                    }
                }
            } catch (error) {
                addResult('任务API测试', false, { error: error.message });
            }
        }
        
        // 页面加载时自动测试
        window.onload = function() {
            addResult('页面加载', true, { 
                location: window.location.href,
                userAgent: navigator.userAgent 
            });
        };
    </script>
</body>
</html> 